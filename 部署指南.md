# Android Container Service éƒ¨ç½²æŒ‡å—

## ðŸ“‹ å‰ç½®æ¡ä»¶

åœ¨éƒ¨ç½²å‰,ç¡®ä¿ç›®æ ‡æœºå™¨ä¸Šå·²å®‰è£…:

- **Docker** (ç”¨äºŽç®¡ç† Android å®¹å™¨)
- **Go 1.16+** (ç”¨äºŽç¼–è¯‘,å¦‚æžœæœ¬åœ°ç¼–è¯‘å¯ä»¥ä¸éœ€è¦)
- **systemd** (Ubuntu/Debian éƒ½æœ‰)

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: ç›´æŽ¥åœ¨ç›®æ ‡æœºå™¨ä¸Šéƒ¨ç½² (æŽ¨è)

```bash
# 1. å°†æ•´ä¸ª android-container-service ç›®å½•ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨
scp -r android-container-service/ root@ç›®æ ‡æœºå™¨IP:/tmp/

# 2. SSHç™»å½•åˆ°ç›®æ ‡æœºå™¨
ssh root@ç›®æ ‡æœºå™¨IP

# 3. è¿›å…¥ç›®å½•
cd /tmp/android-container-service

# 4. è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo bash deploy.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨:

- âœ… ç¼–è¯‘ Go ç¨‹åº
- âœ… åˆ›å»º `/opt/android-container-service` ç›®å½•
- âœ… å¤åˆ¶ç¨‹åºå’Œè„šæœ¬åˆ°å®‰è£…ç›®å½•
- âœ… å®‰è£… systemd æœåŠ¡
- âœ… è¯¢é—®æ˜¯å¦å¯åŠ¨æœåŠ¡

### æ–¹æ³• 2: æœ¬åœ°ç¼–è¯‘åŽéƒ¨ç½²

å¦‚æžœç›®æ ‡æœºå™¨æ²¡æœ‰ Go çŽ¯å¢ƒ,å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘:

```bash
# 1. åœ¨æœ¬åœ°Macä¸Šè¿›è¡ŒLinuxç¼–è¯‘
cd android-container-service
GOOS=linux GOARCH=amd64 go build -o android-container-service .

# 2. ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨
scp -r . a@10.253.207.190:/home/a/tty/android-container-service/

# 3. SSHç™»å½•å¹¶éƒ¨ç½²
ssh root@ç›®æ ‡æœºå™¨IP
cd /home/a/tty/android-container-service
sudo systemctl stop android-container-service.service
sudo bash deploy.sh
```

## âš™ï¸ é…ç½®è¯´æ˜Ž

### ä¿®æ”¹ API æœåŠ¡å™¨åœ°å€

åœ¨éƒ¨ç½²å‰,å¦‚æžœéœ€è¦ä¿®æ”¹ API æœåŠ¡å™¨åœ°å€,ç¼–è¾‘æœåŠ¡æ–‡ä»¶:

```bash
vi android-container-service.service
```

ä¿®æ”¹è¿™ä¸€è¡Œ:

```ini
Environment="API_SERVER=10.50.38.3:25718"
```

æ”¹ä¸ºä½ çš„å®žé™… API æœåŠ¡å™¨åœ°å€ã€‚

### ä¿®æ”¹ç«¯å£

é»˜è®¤ç«¯å£æ˜¯ 8080,å¦‚éœ€ä¿®æ”¹:

```ini
Environment="PORT=8080"
```

## ðŸ”§ æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status android-container-service

# å¯åŠ¨æœåŠ¡
sudo systemctl start android-container-service

# åœæ­¢æœåŠ¡
sudo systemctl stop android-container-service

# é‡å¯æœåŠ¡
sudo systemctl restart android-container-service

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable android-container-service

# ç¦ç”¨å¼€æœºè‡ªå¯
sudo systemctl disable android-container-service

# æŸ¥çœ‹å®žæ—¶æ—¥å¿—
sudo journalctl -u android-container-service -f

# æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f /var/log/android-container-service/android-container-service.log
tail -f /var/log/android-container-service/android-container-service-error.log
```

## ðŸ§ª æµ‹è¯•éƒ¨ç½²

éƒ¨ç½²å®ŒæˆåŽ,æµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸:

```bash
# 1. å¥åº·æ£€æŸ¥
curl http://localhost:8080/api/container/health

# é¢„æœŸå“åº”:
# {
#   "status": "ok",
#   "service": "Android Container Service",
#   "message": "Service is running and ready to manage Android containers"
# }

# 2. æµ‹è¯•åˆ›å»ºå®¹å™¨ (ç¤ºä¾‹)
curl -X POST http://localhost:8080/api/container/create \
  -H "Content-Type: application/json" \
  -d '{
    "host": "10.50.38.3",
    "base_port": 5000,
    "num_containers": 1
  }'
```

## ðŸ“ æ–‡ä»¶ç»“æž„

éƒ¨ç½²åŽçš„æ–‡ä»¶ä½ç½®:

```
/opt/android-container-service/
â”œâ”€â”€ android-container-service      # ä¸»ç¨‹åº
â””â”€â”€ scripts/
    â”œâ”€â”€ batch-create.sh           # æ‰¹é‡åˆ›å»ºè„šæœ¬
    â””â”€â”€ batch-delete.sh           # æ‰¹é‡åˆ é™¤è„šæœ¬

/etc/systemd/system/
â””â”€â”€ android-container-service.service  # systemdæœåŠ¡é…ç½®

/var/log/android-container-service/
â”œâ”€â”€ android-container-service.log       # æ ‡å‡†è¾“å‡ºæ—¥å¿—
â””â”€â”€ android-container-service-error.log # é”™è¯¯æ—¥å¿—
```

## ðŸ” æ•…éšœæŽ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u android-container-service -n 50

# æ£€æŸ¥ç¨‹åºæ˜¯å¦æœ‰æ‰§è¡Œæƒé™
ls -la /opt/android-container-service/android-container-service

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
cd /opt/android-container-service
PORT=8080 ./android-container-service
```

### Docker è¿žæŽ¥å¤±è´¥

```bash
# æ£€æŸ¥DockeræœåŠ¡
sudo systemctl status docker

# æµ‹è¯•Dockerè¿žæŽ¥
docker ps
```

### API è°ƒç”¨å¤±è´¥

```bash
# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo ufw allow 8080/tcp  # å¦‚éœ€å¼€æ”¾ç«¯å£

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080
```

## ðŸ”„ æ›´æ–°éƒ¨ç½²

å½“ä»£ç æ›´æ–°åŽé‡æ–°éƒ¨ç½²:

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop android-container-service

# 2. é‡æ–°ç¼–è¯‘å¹¶å¤åˆ¶
cd /path/to/android-container-service
make build
sudo cp android-container-service /opt/android-container-service/
sudo cp scripts/*.sh /opt/android-container-service/scripts/

# 3. é‡å¯æœåŠ¡
sudo systemctl start android-container-service
```

æˆ–ç›´æŽ¥é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬:

```bash
sudo bash deploy.sh
```

## ðŸ“ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤æ±‡æ€»

```bash
# ä¸€é”®éƒ¨ç½² (åœ¨ç›®æ ‡æœºå™¨ä¸Š)
scp -r android-container-service/ root@ç›®æ ‡IP:/tmp/ && \
ssh root@ç›®æ ‡IP "cd /tmp/android-container-service && bash deploy.sh"

# æœ¬åœ°ç¼–è¯‘ä¸€é”®éƒ¨ç½²
cd android-container-service && \
GOOS=linux GOARCH=amd64 go build -o android-container-service . && \
scp -r . root@ç›®æ ‡IP:/tmp/android-container-service/ && \
ssh root@ç›®æ ‡IP "cd /tmp/android-container-service && bash deploy.sh"
```

## ðŸŒ å¤šæœºå™¨éƒ¨ç½²

å¦‚æžœéœ€è¦åœ¨å¤šå°æœºå™¨ä¸Šéƒ¨ç½²:

```bash
# åˆ›å»ºæœºå™¨åˆ—è¡¨æ–‡ä»¶
cat > hosts.txt << EOF
10.50.38.3
10.50.38.4
10.50.38.5
EOF

# æ‰¹é‡éƒ¨ç½²
while read host; do
  echo "éƒ¨ç½²åˆ° $host ..."
  scp -r android-container-service/ root@$host:/tmp/
  ssh root@$host "cd /tmp/android-container-service && bash deploy.sh"
done < hosts.txt
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ç›®æ ‡æœºå™¨å·²å®‰è£… Docker
- [ ] å·²ä¿®æ”¹ API_SERVER åœ°å€(å¦‚éœ€è¦)
- [ ] å·²ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨
- [ ] deploy.sh æœ‰æ‰§è¡Œæƒé™
- [ ] ä»¥ root æƒé™è¿è¡Œéƒ¨ç½²è„šæœ¬
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥è¿”å›žæ­£å¸¸
- [ ] é˜²ç«å¢™å·²å¼€æ”¾ 8080 ç«¯å£(å¦‚éœ€è¦)
- [ ] å·²è®¾ç½®å¼€æœºè‡ªå¯(å¦‚éœ€è¦)
